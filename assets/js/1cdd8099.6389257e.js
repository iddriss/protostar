"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1573],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return _}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),i=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=i(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=i(n),_=a,f=u["".concat(l,".").concat(_)]||u[_]||p[_]||c;return n?r.createElement(f,o(o({ref:t},d),{},{components:n})):r.createElement(f,o({ref:t},d))}));function _(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,o=new Array(c);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var i=2;i<c;i++)o[i]=n[i];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1576:function(e,t,n){n.r(t),n.d(t,{assets:function(){return l},contentTitle:function(){return o},default:function(){return p},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return i}});var r=n(3117),a=(n(7294),n(3905));const c={},o="expect_call",s={unversionedId:"tutorials/testing/cheatcodes/expect-call",id:"tutorials/testing/cheatcodes/expect-call",title:"expect_call",description:"Allows to specify what calls to contracts' functions are expected in the code. You can use this cheatcode in any place in the code as it checks for the desired calls' existence at the very end of the program's execution.",source:"@site/docs/tutorials/07-testing/02-cheatcodes/expect-call.md",sourceDirName:"tutorials/07-testing/02-cheatcodes",slug:"/tutorials/testing/cheatcodes/expect-call",permalink:"/protostar/docs/tutorials/testing/cheatcodes/expect-call",draft:!1,editUrl:"https://github.com/software-mansion/protostar/tree/master/website/docs/tutorials/07-testing/02-cheatcodes/expect-call.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorials",previous:{title:"example",permalink:"/protostar/docs/tutorials/testing/cheatcodes/example"},next:{title:"expect_events",permalink:"/protostar/docs/tutorials/testing/cheatcodes/expect-events"}},l={},i=[],d={toc:i};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"expect_call"},(0,a.kt)("inlineCode",{parentName:"h1"},"expect_call")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def expect_call(self, contract_address: int, fn_name: str, calldata: list[int]) -> None: ...\n")),(0,a.kt)("p",null,"Allows to specify what calls to contracts' functions are expected in the code. You can use this cheatcode in any place in the code as it checks for the desired calls' existence at the very end of the program's execution."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"calldata")," is a list of arguments that are expected for a certain call. The checking mechanism goes for a strict match, which means that the order, as well as the values of each element, have to be exactly the same."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cairo",metastring:'title="Example"',title:'"Example"'},'%lang starknet\n\n@contract_interface\nnamespace MainContract {\n  func increase_balance(amount_1: felt, amount_2: felt, amount_3: felt) -> () {\n  }\n}\n\n@external\nfunc __setup__() {\n  %{\n    context.ctr_addr_a = deploy_contract("basic_contract.cairo", []).contract_address\n    context.ctr_addr_b = deploy_contract("basic_contract.cairo", []).contract_address\n  %}\n\n  return ();\n}\n\n\n@external\nfunc test_expect_call_success{syscall_ptr: felt*, range_check_ptr}() {\n  tempvar ctr_addr_a;\n  %{ ids.ctr_addr_a = context.ctr_addr_a %}\n  tempvar ctr_addr_b;\n  %{ ids.ctr_addr_b = context.ctr_addr_b %}\n\n  %{\n    expect_call(ids.ctr_addr_a, "increase_balance", [5, 6, 7])\n    expect_call(ids.ctr_addr_b, "increase_balance", [1, 2, 3])\n  %}\n\n  MainContract.increase_balance(contract_address=ctr_addr_a, amount_1=5, amount_2=6, amount_3=7);\n  MainContract.increase_balance(contract_address=ctr_addr_b, amount_1=1, amount_2=2, amount_3=3);\n\n  return ();\n}\n\n@external\nfunc test_expect_call_wrong_args{syscall_ptr: felt*, range_check_ptr}() {\n  tempvar ctr_addr_a;\n  %{\n    ids.ctr_addr_a = context.ctr_addr_a\n    expect_call(ids.ctr_addr_a, "increase_balance", [1, 3, 2])\n  %}\n\n  MainContract.increase_balance(contract_address=ctr_addr_a, amount_1=1, amount_2=2, amount_3=3);\n\n  return ();\n}\n')),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"test_expect_call_wrong_args")," will fail because even though the set of expected arguments is the same as the arguments in the call, the order is different so they ",(0,a.kt)("strong",{parentName:"p"},"do not")," strictly match."))}p.isMDXComponent=!0}}]);