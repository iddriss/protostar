"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9056],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=a,g=d["".concat(c,".").concat(m)]||d[m]||p[m]||i;return n?r.createElement(g,o(o({ref:t},u),{},{components:n})):r.createElement(g,o({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2991:function(e,t,n){n.d(t,{Z:function(){return k}});var r=n(7294),a=n(4334),i=n(2802),o=n(9960),s=n(3919),c=n(5999),l="cardContainer_fWXF",u="cardTitle_rnsV",p="cardDescription_PWke";function d(e){let{href:t,children:n}=e;return r.createElement(o.Z,{href:t,className:(0,a.Z)("card padding--lg",l)},n)}function m(e){let{href:t,icon:n,title:i,description:o}=e;return r.createElement(d,{href:t},r.createElement("h2",{className:(0,a.Z)("text--truncate",u),title:i},n," ",i),o&&r.createElement("p",{className:(0,a.Z)("text--truncate",p),title:o},o))}function g(e){let{item:t}=e;const n=(0,i.Wl)(t);return n?r.createElement(m,{href:n,icon:"\ud83d\uddc3\ufe0f",title:t.label,description:(0,c.I)({message:"{count} items",id:"theme.docs.DocCard.categoryDescription",description:"The default description for a category card in the generated index about how many items this category includes"},{count:t.items.length})}):null}function f(e){let{item:t}=e;const n=(0,s.Z)(t.href)?"\ud83d\udcc4\ufe0f":"\ud83d\udd17",a=(0,i.xz)(t.docId??void 0);return r.createElement(m,{href:t.href,icon:n,title:t.label,description:null==a?void 0:a.description})}function h(e){let{item:t}=e;switch(t.type){case"link":return r.createElement(f,{item:t});case"category":return r.createElement(g,{item:t});default:throw new Error(`unknown item type ${JSON.stringify(t)}`)}}function y(e){let{className:t}=e;const n=(0,i.jA)();return r.createElement(k,{items:n.items,className:t})}function k(e){const{items:t,className:n}=e;if(!t)return r.createElement(y,e);const o=(0,i.MN)(t);return r.createElement("section",{className:(0,a.Z)("row",n)},o.map(((e,t)=>r.createElement("article",{key:t,className:"col col--6 margin-bottom--lg"},r.createElement(h,{item:e})))))}},4576:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p}});var r=n(3117),a=(n(7294),n(3905)),i=n(2991),o=n(2802);const s={},c="Migrations",l={unversionedId:"tutorials/deploying/migrations/README",id:"tutorials/deploying/migrations/README",title:"Migrations",description:"Migrations feature is deprecated and is scheduled for removal before Cairo 1.0 release.",source:"@site/docs/tutorials/08-deploying/02-migrations/README.md",sourceDirName:"tutorials/08-deploying/02-migrations",slug:"/tutorials/deploying/migrations/",permalink:"/protostar/docs/tutorials/deploying/migrations/",draft:!1,editUrl:"https://github.com/software-mansion/protostar/tree/master/website/docs/tutorials/08-deploying/02-migrations/README.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorials",previous:{title:"CLI",permalink:"/protostar/docs/tutorials/deploying/cli"},next:{title:"call",permalink:"/protostar/docs/tutorials/deploying/migrations/call"}},u={},p=[{value:"Creating a migration file",id:"creating-a-migration-file",level:2},{value:"Migration file structure",id:"migration-file-structure",level:2},{value:"Running the migration",id:"running-the-migration",level:2},{value:"Lack of Atomicity",id:"lack-of-atomicity",level:2},{value:"Signing the migration",id:"signing-the-migration",level:2},{value:"Available migration cheatcodes",id:"available-migration-cheatcodes",level:2}],d={toc:p};function m(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"migrations"},"Migrations"),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"Migrations feature is deprecated and is scheduled for removal before Cairo 1.0 release."),(0,a.kt)("p",{parentName:"admonition"},"Declaring and deploying contracts via ",(0,a.kt)("a",{parentName:"p",href:"/protostar/docs/tutorials/deploying/cli"},"Protostar CLI")," is the recommended approach.\nAlternatively, one can only build contracts with Protostar and use custom scripts using one\nof ",(0,a.kt)("a",{parentName:"p",href:"https://starknet.io/building-on-starknet/developer-tools/#libraries"},"StarkNet's SDKs")," available.")),(0,a.kt)("p",null,"Migrations are Cairo files that help you manage contracts on the StarkNet.\nThese files are responsible for staging your deployment tasks, and they're written under the assumption that your project uses ",(0,a.kt)("a",{parentName:"p",href:"https://blog.openzeppelin.com/proxy-patterns/"},"Proxy Pattern"),".\nAs your project evolves, you'll create new migration scripts to reflect this evolution on the Starknet."),(0,a.kt)("h2",{id:"creating-a-migration-file"},"Creating a migration file"),(0,a.kt)("p",null,"You can create a migration file anywhere, but we recommend creating them inside a ",(0,a.kt)("inlineCode",{parentName:"p"},"migrations")," directory. Currently, Protostar doesn't enforce any naming convention for migration files. In this document we use a naming convention: ",(0,a.kt)("inlineCode",{parentName:"p"},"migration_NUMBER_TITLE.cairo"),", for example ",(0,a.kt)("inlineCode",{parentName:"p"},"migration_01_init.cairo"),"."),(0,a.kt)("h2",{id:"migration-file-structure"},"Migration file structure"),(0,a.kt)("p",null,"The migration needs to have a function ",(0,a.kt)("inlineCode",{parentName:"p"},"up"),". This function should be responsible for migrating your project forward. To interact with StarkNet, use ",(0,a.kt)("a",{parentName:"p",href:"#available-migration-cheatcodes"},"migration cheatcodes"),". "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cairo",metastring:'title="Deploying storage and logic contracts"',title:'"Deploying',storage:!0,and:!0,logic:!0,'contracts"':!0},'%lang starknet\n\n@external\nfunc up() {\n    %{\n        logic_contract_address = deploy_contract("main").contract_address\n        storage_contract_address = deploy_contract("proxy", [logic_contract_address]).contract_address\n    %}\n    return ();\n}\n\n@external\nfunc down() {\n    %{ assert False, "Not implemented" %}\n    return ();\n}\n')),(0,a.kt)("h2",{id:"running-the-migration"},"Running the migration"),(0,a.kt)("p",null,"To run the migration execute the ",(0,a.kt)("inlineCode",{parentName:"p"},"migrate")," command."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Running the migration to the testnet"',title:'"Running',the:!0,migration:!0,to:!0,'testnet"':!0},"protostar migrate migrations/migration_01_init.cairo\n    --network testnet\n")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"protostar migrate --help")," to display all parameters supported by this command.")),(0,a.kt)("p",null,"Protostar asks, if you build the project to prevent you from running the migration on an outdated build output."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:"title=\"Type 'y' to continue\"",title:'"Type',"'y'":!0,to:!0,'continue"':!0},"Did you build the project before running this command? [y/n]: \n")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"protostar migrate")," with the ",(0,a.kt)("inlineCode",{parentName:"p"},"--no-confirm")," flag to skip this check.")),(0,a.kt)("p",null,"If you build the project, Protostar will print migration logs in the command line."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="You can use this output for the debugging purposes"',title:'"You',can:!0,use:!0,this:!0,output:!0,for:!0,the:!0,debugging:!0,'purposes"':!0},"[INFO] (Protostar \u2192 StarkNet) DECLARE\n  contract             /.../protostar/playground/standard/build/main.json\n  sender_address       1\n  max_fee              0\n  version              0\n  signature            []\n  nonce                0\n[INFO] (Protostar \u2190 StarkNet) DECLARE\n  code                 TRANSACTION_RECEIVED\n  class_hash           123456...\n  transaction_hash     0x1234...\n[INFO] Migration completed\n")),(0,a.kt)("h2",{id:"lack-of-atomicity"},"Lack of Atomicity"),(0,a.kt)("p",null,"If one of the cheatcode fails (e.g. ",(0,a.kt)("a",{parentName:"p",href:"migrations/invoke"},"invoke cheatcode"),"), introduced changes won't be reverted."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cairo"},'%lang starknet\n\n@external\nfunc up() { \n    %{ \n        # this deploy won\'t be reverted\n        logic_contract_address = deploy_contract("./build/main.json").contract_address\n\n        # if this deploy fails\n        storage_contract_address = deploy_contract("./build/proxy.json", [logic_contract_address]).contract_address \n    %}\n    return ();\n}\n\nIf atomicity is essential and you need only to use deploy and invoke transactions, consider using [Contract Classes](https://docs.starknet.io/documentation/develop/Contracts/contract-classes/).\n')),(0,a.kt)("h2",{id:"signing-the-migration"},"Signing the migration"),(0,a.kt)("p",null,"You can sign the migration's transactions by providing appropriate arguments to the CLI of the command.\nSee signing-related documentation ",(0,a.kt)("a",{parentName:"p",href:"/protostar/docs/tutorials/deploying/cli#signing-a-declaration"},"here"),"."),(0,a.kt)("p",null,"For now, declare and invoke migration calls are signed automatically when provided with appropriate arguments."),(0,a.kt)("h2",{id:"available-migration-cheatcodes"},"Available migration cheatcodes"),(0,a.kt)(i.Z,{items:(0,o.jA)().items,mdxType:"DocCardList"}))}m.isMDXComponent=!0}}]);